<!DOCTYPE html>
<html
  :dir="lang === 'ar' ? 'rtl' : 'ltr'"
  :lang="lang"
  class="transition-colors duration-300"
  x-data="ibanApp()"
  x-init="init(); $watch('themePreference', val => applyTheme(val))"
>
<head>
    <script>
      (() => {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const storedPreference = localStorage.getItem('themePreference');
        const legacyDarkMode = localStorage.getItem('darkMode');
        const resolvedPreference = storedPreference
          || (legacyDarkMode === 'true' ? 'dark' : legacyDarkMode === 'false' ? 'light' : 'auto');
        const useDark = resolvedPreference === 'dark'
          ? true
          : resolvedPreference === 'light'
            ? false
            : prefersDark;
        document.documentElement.classList.toggle('dark', useDark);
      })();

      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        const storedPreference = localStorage.getItem('themePreference');
        const legacyDarkMode = localStorage.getItem('darkMode');
        const resolvedPreference = storedPreference
          || (legacyDarkMode === 'true' ? 'dark' : legacyDarkMode === 'false' ? 'light' : 'auto');
        if (resolvedPreference === 'auto') {
          const prefersDarkNow = e.matches;
          document.documentElement.classList.toggle('dark', prefersDarkNow);
          const rootScope = document.querySelector('[x-data]');
          if (rootScope && rootScope.__x && rootScope.__x.$data) {
            rootScope.__x.$data.darkMode = prefersDarkNow;
            rootScope.__x.$data.themePreference = 'auto';
          }
        }
      });
    </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saudi IBAN Random Generator | Valid SA IBANs & Bank Codes</title>
  <meta name="description" content="Generate random Saudi IBANs instantly. Create valid-format SA IBAN numbers with real Saudi bank codes for testing, demos, and education.">
  <meta name="keywords" content="Saudi IBAN generator, SA IBAN, IBAN random generator, Saudi bank IBAN, IBAN format, Saudi Arabia IBAN, IBAN validation, IBAN sample">
  <meta name="author" content="Saudi IBAN Generator">
  <link rel="canonical" href="https://a-almazyad.github.io/saudi-iban-generator/">
  <meta name="robots" content="index, follow">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Saudi IBAN Random Generator">
  <meta property="og:description" content="Generate random Saudi IBANs instantly with valid SA format and bank codes.">
  <meta property="og:url" content="https://a-almazyad.github.io/saudi-iban-generator/">
  <meta property="og:image" content="https://a-almazyad.github.io/saudi-iban-generator/IBAN.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:locale" content="en_US">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Saudi IBAN Random Generator">
  <meta name="twitter:description" content="Generate random Saudi IBANs instantly with valid SA format and bank codes.">
  <meta name="twitter:image" content="https://a-almazyad.github.io/saudi-iban-generator/IBAN.png">
  <meta name="twitter:site" content="@a_almazyad">
  <link rel="alternate" hreflang="en" href="https://a-almazyad.github.io/saudi-iban-generator/">
  <link rel="alternate" hreflang="ar" href="https://a-almazyad.github.io/saudi-iban-generator/">
  <link rel="alternate" hreflang="x-default" href="https://a-almazyad.github.io/saudi-iban-generator/">
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Saudi IBAN Random Generator",
      "url": "https://a-almazyad.github.io/saudi-iban-generator/",
      "description": "Generate random Saudi IBANs instantly with valid SA format and Saudi bank codes for testing, demos, and education.",
      "inLanguage": ["en", "ar"],
      "publisher": {
        "@type": "Person",
        "name": "a-almazyad",
        "url": "https://github.com/a-almazyad"
      }
    }
  </script>
  <script src="https://cdn.tailwindcss.com/3.4.1"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    };
  </script>
  <script src="https://unpkg.com/alpinejs@3.13.10/dist/cdn.min.js" defer></script>
  <script src="creditCard.js"></script>
  <link rel="icon" type="image/svg+xml" href="saudi-flag.svg">
  <link rel="apple-touch-icon" href="saudi-flag.svg">
  <style>
    :root {
      --background: 0 0% 100%;
      --foreground: 222.2 47.4% 11.2%;
      --card: 0 0% 100%;
      --card-foreground: 222.2 47.4% 11.2%;
      --popover: 0 0% 100%;
      --popover-foreground: 222.2 47.4% 11.2%;
      --primary: 222.2 47.4% 11.2%;
      --primary-foreground: 210 40% 98%;
      --secondary: 210 40% 96.1%;
      --secondary-foreground: 222.2 47.4% 11.2%;
      --muted: 210 40% 96.1%;
      --muted-foreground: 215.4 16.3% 46.9%;
      --accent: 210 40% 96.1%;
      --accent-foreground: 222.2 47.4% 11.2%;
      --destructive: 0 100% 50%;
      --destructive-foreground: 210 40% 98%;
      --border: 214.3 31.8% 91.4%;
      --input: 214.3 31.8% 91.4%;
      --ring: 215 20.2% 65.1%;
      --radius: 0.5rem;
    }

    .dark {
      --background: 224 71% 4%;
      --foreground: 213 31% 91%;
      --card: 224 71% 4%;
      --card-foreground: 213 31% 91%;
      --popover: 224 71% 4%;
      --popover-foreground: 213 31% 91%;
      --primary: 210 40% 98%;
      --primary-foreground: 222.2 47.4% 11.2%;
      --secondary: 222.2 47.4% 11.2%;
      --secondary-foreground: 210 40% 98%;
      --muted: 223 47% 11%;
      --muted-foreground: 215.4 16.3% 56.9%;
      --accent: 216 34% 17%;
      --accent-foreground: 210 40% 98%;
      --destructive: 0 63% 31%;
      --destructive-foreground: 210 40% 98%;
      --border: 216 34% 17%;
      --input: 216 34% 17%;
      --ring: 216 34% 17%;
    }

    @keyframes spinHalf {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(180deg); }
    }
    .animate-spin-half { animation: spinHalf 0.5s ease-in-out; }

    [x-cloak] { display: none !important; }

    .history-list-item { will-change: opacity, transform; }
    .iban-text { font-size: 0.9rem; line-height: 1.4; }
    @media (min-width: 640px) {
      .iban-text { font-size: 0.95rem; }
    }
    .force-ltr { direction: ltr !important; text-align: left !important; }
    .bank-mark {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 9999px;
      background: hsl(var(--accent));
      color: hsl(var(--accent-foreground));
      font-weight: 600;
      text-transform: uppercase;
      line-height: 1;
    }
  </style>
</head>
<body class="bg-[hsl(var(--background))] text-[hsl(var(--foreground))] min-h-screen transition-colors duration-300">
  <div
    x-show="showToast"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0 transform translate-y-2"
    x-transition:enter-end="opacity-100 transform translate-y-0"
    x-transition:leave="transition ease-in duration-300"
    x-transition:leave-start="opacity-100 transform translate-y-0"
    x-transition:leave-end="opacity-0 transform translate-y-2"
    class="fixed top-6 left-1/2 z-50 flex w-full max-w-sm -translate-x-1/2 items-center gap-2 rounded-lg border border-[hsl(var(--border))] bg-[hsl(var(--background))] px-4 py-3 text-sm font-medium shadow-lg"
    x-cloak
    role="alert"
    aria-live="polite"
  >
    <span x-text="toastMessage"></span>
    <span x-show="toastType === 'success'" aria-hidden="true">‚úÖ</span>
    <span x-show="toastType === 'info'" aria-hidden="true">‚ÑπÔ∏è</span>
    <span x-show="toastType === 'error'" aria-hidden="true">‚ùå</span>
  </div>

  <div class="mx-auto flex min-h-screen w-full max-w-6xl flex-col px-4 py-12">
    <header class="flex flex-col gap-6 md:flex-row md:items-center md:justify-between">
      <div class="space-y-2">
        <p class="text-sm font-medium text-[hsl(var(--muted-foreground))]" x-text="lang === 'en' ? 'Saudi IBAN Generator' : 'ŸÖŸàŸÑÿØ ÿßŸÑÿ¢Ÿäÿ®ÿßŸÜ ÿßŸÑÿ≥ÿπŸàÿØŸä'"></p>
        <h1 class="text-2xl font-semibold tracking-tight" x-text="lang === 'en' ? 'Generate compliant Saudi IBANs and cards' : 'ÿ™ŸàŸÑŸäÿØ ÿ¢Ÿäÿ®ÿßŸÜÿßÿ™ Ÿàÿ®ÿ∑ÿßŸÇÿßÿ™ ÿ≥ÿπŸàÿØŸäÿ© ŸÖÿ™ŸàÿßŸÅŸÇÿ©'"></h1>
        <p
          class="text-sm text-[hsl(var(--muted-foreground))]"
          x-html="lang === 'en' ? 'Built by <a href=&quot;https://github.com/a-almazyad&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; class=&quot;underline underline-offset-2&quot;>@a-almazyad</a> using AI.' : 'ÿ™ŸÖ ÿßŸÑÿ®ŸÜÿßÿ° ÿ®Ÿàÿßÿ≥ÿ∑ÿ© <a href=&quot;https://github.com/a-almazyad&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; class=&quot;underline underline-offset-2&quot;>@a-almazyad</a> ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä.'"
        ></p>
      </div>
      <div class="flex items-center gap-2">
        <div class="inline-flex items-center rounded-md border border-[hsl(var(--border))] bg-[hsl(var(--muted))] p-1 text-xs font-medium text-[hsl(var(--muted-foreground))]">
          <button
            @click="setTheme('light')"
            type="button"
            class="inline-flex items-center gap-1 rounded-sm px-2.5 py-1 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))]"
            :class="themePreference === 'light' ? 'bg-[hsl(var(--background))] text-[hsl(var(--foreground))] shadow' : ''"
            :aria-pressed="(themePreference === 'light').toString()"
            :title="lang === 'en' ? 'Light theme' : 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÅÿßÿ™ÿ≠'"
          >
            <svg class="h-4 w-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
            <span x-text="lang === 'en' ? 'Light' : 'ŸÅÿßÿ™ÿ≠'"></span>
          </button>
          <button
            @click="setTheme('dark')"
            type="button"
            class="inline-flex items-center gap-1 rounded-sm px-2.5 py-1 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))]"
            :class="themePreference === 'dark' ? 'bg-[hsl(var(--background))] text-[hsl(var(--foreground))] shadow' : ''"
            :aria-pressed="(themePreference === 'dark').toString()"
            :title="lang === 'en' ? 'Dark theme' : 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ'"
          >
            <svg class="h-4 w-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
            <span x-text="lang === 'en' ? 'Dark' : 'ÿØÿßŸÉŸÜ'"></span>
          </button>
          <button
            @click="setTheme('auto')"
            type="button"
            class="inline-flex items-center gap-1 rounded-sm px-2.5 py-1 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))]"
            :class="themePreference === 'auto' ? 'bg-[hsl(var(--background))] text-[hsl(var(--foreground))] shadow' : ''"
            :aria-pressed="(themePreference === 'auto').toString()"
            :title="lang === 'en' ? 'Match system theme' : 'ŸÖÿ∑ÿßÿ®ŸÇÿ© ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ'"
          >
            <svg class="h-4 w-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><path d="M8 21h8M12 17v4"/></svg>
            <span x-text="lang === 'en' ? 'Auto' : 'ÿ™ŸÑŸÇÿßÿ¶Ÿä'"></span>
          </button>
        </div>
        <button
          @click="lang = lang === 'en' ? 'ar' : 'en'; localStorage.setItem('lang', lang)"
          @keydown.enter.prevent="lang = lang === 'en' ? 'ar' : 'en'; localStorage.setItem('lang', lang)"
          @keydown.space.prevent="lang = lang === 'en' ? 'ar' : 'en'; localStorage.setItem('lang', lang)"
          type="button"
          class="inline-flex h-9 w-9 items-center justify-center rounded-md border border-[hsl(var(--input))] bg-[hsl(var(--background))] text-sm font-medium text-[hsl(var(--foreground))] shadow-sm transition-colors hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))] disabled:pointer-events-none disabled:opacity-50"
          :aria-label="lang === 'en' ? 'ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' : 'Switch to English'"
          :title="lang === 'en' ? 'ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' : 'Switch to English'"
        >
          <span x-text="lang === 'en' ? 'AR' : 'EN'" class="text-xs font-semibold tracking-wide" aria-hidden="true"></span>
          <span class="sr-only" x-text="lang === 'en' ? 'Switch to Arabic' : 'ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©'"></span>
        </button>
      </div>
    </header>

    <main class="mt-10 grid gap-6">
      <div class="flex justify-center" role="tablist">
        <div class="inline-flex h-10 items-center justify-center rounded-md bg-[hsl(var(--muted))] p-1 text-[hsl(var(--muted-foreground))]">
          <button
            @click="activeTab='iban'"
            class="inline-flex items-center justify-center rounded-sm px-3 py-1.5 text-sm font-medium transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))]"
            :class="activeTab==='iban' ? 'bg-[hsl(var(--background))] text-[hsl(var(--foreground))] shadow' : ''"
          >
            <span x-text="lang === 'en' ? 'IBAN' : 'ÿßŸÑÿ¢Ÿäÿ®ÿßŸÜ'"></span>
          </button>
          <button
            @click="activeTab='card'"
            class="inline-flex items-center justify-center rounded-sm px-3 py-1.5 text-sm font-medium transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))]"
            :class="activeTab==='card' ? 'bg-[hsl(var(--background))] text-[hsl(var(--foreground))] shadow' : ''"
          >
            <span x-text="lang === 'en' ? 'Credit Card' : 'ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑÿßÿ¶ÿ™ŸÖÿßŸÜ'"></span>
          </button>
        </div>
      </div>

      <div x-show="activeTab==='iban'" class="grid gap-6 lg:grid-cols-2" x-cloak>
        <section aria-labelledby="generator-heading" class="flex min-h-[500px] flex-col rounded-lg border border-[hsl(var(--border))] bg-[hsl(var(--card))] text-[hsl(var(--card-foreground))] shadow-sm">
          <div class="flex flex-col space-y-1.5 p-6">
            <h2 id="generator-heading" class="text-xl font-semibold" x-text="lang === 'en' ? 'Saudi IBAN Generator' : 'ŸÖŸàŸÑÿØ ÿßŸÑÿ¢Ÿäÿ®ÿßŸÜ ÿßŸÑÿ≥ÿπŸàÿØŸä'"></h2>
            <p class="text-sm text-[hsl(var(--muted-foreground))]" x-text="lang === 'en' ? 'Generate valid-format Saudi IBANs.' : 'ÿ™ŸàŸÑŸäÿØ ÿ¢Ÿäÿ®ÿßŸÜÿßÿ™ ÿ≥ÿπŸàÿØŸäÿ© ÿ®ÿ™ŸÜÿ≥ŸäŸÇ ÿµÿ≠Ÿäÿ≠.'"></p>
          </div>
          <div class="flex flex-1 flex-col space-y-5 px-6 pb-6">
            <div
              class="min-h-[160px] rounded-md border border-[hsl(var(--border))] bg-[hsl(var(--muted))] p-4 text-left"
            >
              <div class="flex items-start justify-between gap-2">
                <p class="text-xs font-semibold text-[hsl(var(--muted-foreground))]" :class="lang === 'ar' ? 'text-right' : 'text-left'" x-text="lang === 'en' ? 'Generated IBAN' : 'ÿßŸÑÿ¢Ÿäÿ®ÿßŸÜ ÿßŸÑŸÖŸèŸàŸÑÿØ'"></p>
                <button
                  @click="copyIban()"
                  :disabled="!generatedIban"
                  type="button"
                  class="inline-flex h-8 w-8 items-center justify-center rounded-md text-[hsl(var(--muted-foreground))] transition hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))] disabled:pointer-events-none disabled:opacity-50"
                  :aria-label="lang === 'en' ? 'Copy IBAN' : 'ŸÜÿ≥ÿÆ ÿßŸÑÿ¢Ÿäÿ®ÿßŸÜ'"
                  :title="lang === 'en' ? 'Copy IBAN' : 'ŸÜÿ≥ÿÆ ÿßŸÑÿ¢Ÿäÿ®ÿßŸÜ'"
                >
                  <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                </button>
              </div>
              <p class="mt-2 font-mono text-base text-[hsl(var(--foreground))] md:text-lg force-ltr" x-ref="ibanText" x-text="animatedIban.length ? formatIban(animatedIban.join('')) : 'SA XX XXXX XXXX XXXX XXXX XXXX'"></p>
              <div class="mt-2 flex items-center gap-2 text-xs text-[hsl(var(--muted-foreground))]" :class="lang === 'ar' ? 'flex-row-reverse text-right' : 'text-left'">
                <template x-if="generatedIban?.bankCode && bankOptions[generatedIban.bankCode]">
                  <span class="bank-mark h-4 w-4 text-[10px]" x-text="bankOptions[generatedIban.bankCode]?.mark"></span>
                </template>
                <span class="truncate" x-text="animatedBankName || (generatedIban?.bank || (lang === 'en' ? 'N/A' : 'ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠'))"></span>
              </div>
            </div>

            <div class="space-y-2 text-left">
              <label id="bank-select-label" class="text-sm font-medium" x-text="lang === 'en' ? 'Choose a bank (optional)' : 'ÿßÿÆÿ™ÿ± ÿ®ŸÜŸÉŸãÿß (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)'" :class="lang === 'ar' ? 'text-right' : ''"></label>
              <div class="relative" x-data="{ dropdownOpen: false }">
                <button
                  @click="dropdownOpen = !dropdownOpen"
                  type="button"
                  aria-haspopup="listbox"
                  :aria-expanded="dropdownOpen.toString()"
                  aria-controls="bank-dropdown-list"
                  aria-labelledby="bank-select-label"
                  class="flex h-11 w-full items-center justify-between rounded-md border border-[hsl(var(--input))] bg-[hsl(var(--background))] px-3 text-sm shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))]"
                >
                  <span class="flex items-center gap-2 overflow-hidden">
                    <template x-if="computedBank()">
                      <img
                        class="h-5 w-5 rounded-full bg-white object-contain p-0.5"
                        :src="computedBank().logo"
                        :alt="lang === 'en' ? computedBank().name + ' logo' : 'ÿ¥ÿπÿßÿ± ' + computedBank().ar"
                      />
                    </template>
                    <template x-if="!selectedBankCode">
                      <span class="text-lg" aria-hidden="true">üé≤</span>
                    </template>
                    <span class="truncate" x-text="computedBank() ? (lang === 'en' ? computedBank().name : computedBank().ar) : (lang === 'en' ? 'Random Bank' : 'ÿ®ŸÜŸÉ ÿπÿ¥Ÿàÿßÿ¶Ÿä')"></span>
                  </span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 h-4 w-4 transition-transform duration-200" :class="{ 'rotate-180': dropdownOpen }" aria-hidden="true"><polyline points="6 9 12 15 18 9"/></svg>
                </button>
                <div
                  x-show="dropdownOpen"
                  @click.outside="dropdownOpen = false"
                  x-transition:enter="transition ease-out duration-100"
                  x-transition:enter-start="opacity-0 scale-95"
                  x-transition:enter-end="opacity-100 scale-100"
                  x-transition:leave="transition ease-in duration-75"
                  x-transition:leave-start="opacity-100 scale-100"
                  x-transition:leave-end="opacity-0 scale-95"
                  class="absolute z-20 mt-1 max-h-64 w-full overflow-y-auto rounded-md border border-[hsl(var(--border))] bg-[hsl(var(--popover))] p-1 shadow-md"
                  id="bank-dropdown-list"
                  role="listbox"
                  :aria-labelledby="bank-select-label"
                  tabindex="-1"
                  x-cloak
                >
                  <div
                    @click="selectedBankCode = ''; dropdownOpen = false; $event.target.closest('button').focus()"
                    role="option"
                    :aria-selected="selectedBankCode === ''"
                    tabindex="0"
                    @keydown.enter.prevent.stop="selectedBankCode = ''; dropdownOpen = false; $event.target.closest('button').focus()"
                    @keydown.space.prevent.stop="selectedBankCode = ''; dropdownOpen = false; $event.target.closest('button').focus()"
                    class="flex items-center gap-2 rounded-sm px-3 py-2 text-sm transition hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))] focus:bg-[hsl(var(--accent))] focus:text-[hsl(var(--accent-foreground))]"
                    :class="selectedBankCode === '' ? 'bg-[hsl(var(--accent))] text-[hsl(var(--accent-foreground))]' : ''"
                  >
                    <span class="text-lg" aria-hidden="true">üé≤</span>
                    <span x-text="lang === 'en' ? 'Random Bank' : 'ÿ®ŸÜŸÉ ÿπÿ¥Ÿàÿßÿ¶Ÿä'"></span>
                  </div>
                  <template x-for="(bank, code) in bankOptions" :key="code">
                    <div
                      @click="selectedBankCode = code; dropdownOpen = false; $event.target.closest('button').focus()"
                      role="option"
                      :aria-selected="selectedBankCode === code"
                      tabindex="0"
                      @keydown.enter.prevent.stop="selectedBankCode = code; dropdownOpen = false; $event.target.closest('button').focus()"
                      @keydown.space.prevent.stop="selectedBankCode = code; dropdownOpen = false; $event.target.closest('button').focus()"
                    class="flex items-center rounded-sm px-3 py-2 text-sm transition hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))] focus:bg-[hsl(var(--accent))] focus:text-[hsl(var(--accent-foreground))]"
                    :class="selectedBankCode === code ? 'bg-[hsl(var(--accent))] text-[hsl(var(--accent-foreground))]' : ''"
                  >
                      <img
                        class="h-4 w-4 rounded-full bg-white object-contain p-0.5"
                        :class="lang === 'ar' ? 'ml-3' : 'mr-3'"
                        :src="bank.logo"
                        :alt="lang === 'en' ? bank.name + ' logo' : 'ÿ¥ÿπÿßÿ± ' + bank.ar"
                      />
                      <span x-text="lang === 'en' ? bank.name : bank.ar"></span>
                    </div>
                  </template>
                </div>
              </div>
            </div>

            <button
              @click="generateIban()"
              type="button"
              class="mt-auto inline-flex h-11 w-full items-center justify-center gap-2 rounded-md bg-[hsl(var(--primary))] px-4 text-sm font-medium text-[hsl(var(--primary-foreground))] shadow transition hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))] disabled:pointer-events-none disabled:opacity-70"
              :disabled="generating"
              :class="{ 'opacity-75 cursor-wait': generating }"
              x-ref="generateButton"
            >
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" :class="{ 'animate-spin-half': generating }"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
              <span x-text="generating ? (lang === 'en' ? 'Generating...' : 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ŸàŸÑŸäÿØ...') : (lang === 'en' ? 'Generate IBAN' : 'ÿ™ŸàŸÑŸäÿØ ÿ¢Ÿäÿ®ÿßŸÜ')"></span>
            </button>
          </div>
        </section>

        <section aria-labelledby="history-heading" class="flex min-h-[500px] flex-col rounded-lg border border-[hsl(var(--border))] bg-[hsl(var(--card))] text-[hsl(var(--card-foreground))] shadow-sm">
          <div class="flex items-center justify-between p-6">
            <div class="space-y-1">
              <h2 id="history-heading" class="text-base font-semibold" x-text="lang === 'en' ? 'Recent IBANs' : 'ÿßŸÑÿ¢Ÿäÿ®ÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿÆŸäÿ±ÿ©'"></h2>
              <p class="text-xs text-[hsl(var(--muted-foreground))]" x-text="lang === 'en' ? 'Last generated IBANs and banks.' : 'ÿ¢ÿÆÿ± ÿßŸÑÿ¢Ÿäÿ®ÿßŸÜÿßÿ™ ŸàÿßŸÑÿ®ŸÜŸàŸÉ ÿßŸÑŸÖŸèŸàŸÑÿØÿ©.'"></p>
            </div>
            <button
              @click="clearHistory()"
              type="button"
              class="inline-flex items-center gap-1 rounded-md border border-transparent px-2 py-1 text-xs font-medium transition hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))] disabled:opacity-50"
              :disabled="!ibanHistory.length"
              :aria-label="lang === 'en' ? 'Clear History' : 'ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ'"
              :title="lang === 'en' ? 'Clear History' : 'ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ'"
            >
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6m5 0V4a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v2"/></svg>
              <span x-text="lang === 'en' ? 'Clear' : 'ŸÖÿ≥ÿ≠'"></span>
            </button>
          </div>
          <div class="flex flex-1 flex-col px-6 pb-6">
            <div class="min-h-[180px] flex-1">
              <template x-if="ibanHistory.length">
                <ul class="space-y-2" aria-labelledby="history-heading">
                  <template x-for="(item, index) in ibanHistory.slice(0, 4)" :key="item.iban + index">
                    <li
                      class="history-list-item iban-history-list-item rounded-md border border-[hsl(var(--border))] p-3 text-sm transition"
                      :class="{
                        'bg-[hsl(var(--background))] shadow-sm': index === 0,
                        'bg-[hsl(var(--muted))]': index > 0
                      }"
                      x-transition:enter="transition ease-out duration-300"
                      x-transition:enter-start="opacity-0 transform -translate-y-2"
                      x-transition:enter-end="opacity-100 transform translate-y-0"
                    >
                      <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                        <div class="flex items-center gap-2 min-w-0">
                          <span class="iban-text font-mono text-[hsl(var(--foreground))] truncate force-ltr" x-text="formatIban(item.iban)" :title="item.iban"></span>
                          <button
                            @click="copyIbanFromHistory(item.iban)"
                            type="button"
                            class="inline-flex h-8 w-8 items-center justify-center rounded-md text-[hsl(var(--muted-foreground))] transition hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))]"
                            :aria-label="(lang === 'en' ? 'Copy IBAN: ' : 'ŸÜÿ≥ÿÆ ÿßŸÑÿ¢Ÿäÿ®ÿßŸÜ: ') + item.iban"
                            :title="lang === 'en' ? 'Copy' : 'ŸÜÿ≥ÿÆ'"
                          >
                            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                          </button>
                        </div>
                        <div class="flex items-center gap-2 text-xs text-[hsl(var(--muted-foreground))]">
                          <template x-if="getBankInfoByName(item.bank)">
                            <img
                              class="h-4 w-4 rounded-full bg-white object-contain p-0.5"
                              :src="getBankInfoByName(item.bank)?.logo"
                              :alt="lang === 'en' ? getBankInfoByName(item.bank)?.name + ' logo' : 'ÿ¥ÿπÿßÿ± ' + getBankInfoByName(item.bank)?.ar"
                            />
                          </template>
                          <span class="truncate" x-text="lang === 'en' ? item.bank : (getBankInfoByName(item.bank)?.ar || item.bank)" :title="lang === 'en' ? item.bank : (getBankInfoByName(item.bank)?.ar || item.bank)"></span>
                        </div>
                      </div>
                    </li>
                  </template>
                </ul>
              </template>
              <template x-if="!ibanHistory.length">
                <p class="pt-10 text-center text-sm text-[hsl(var(--muted-foreground))]" x-text="lang === 'en' ? 'No recent IBANs.' : 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¢Ÿäÿ®ÿßŸÜÿßÿ™ ÿ≠ÿØŸäÿ´ÿ©.'"></p>
              </template>
            </div>
          </div>
        </section>

        <section aria-labelledby="banks-heading" class="lg:col-span-2 rounded-lg border border-[hsl(var(--border))] bg-[hsl(var(--card))] text-[hsl(var(--card-foreground))] shadow-sm">
          <div class="space-y-1.5 p-6">
            <h2 id="banks-heading" class="text-base font-semibold" x-text="lang === 'en' ? 'Supported Saudi Banks' : 'ÿßŸÑÿ®ŸÜŸàŸÉ ÿßŸÑÿ≥ÿπŸàÿØŸäÿ© ÿßŸÑŸÖÿØÿπŸàŸÖÿ©'"></h2>
            <p class="text-xs text-[hsl(var(--muted-foreground))]" x-text="lang === 'en' ? 'Browse the banks and their official logos.' : 'ÿßÿ≥ÿ™ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸÜŸàŸÉ Ÿàÿ¥ÿπÿßÿ±ÿßÿ™Ÿáÿß ÿßŸÑÿ±ÿ≥ŸÖŸäÿ©.'"></p>
          </div>
          <div class="px-6 pb-6">
            <ul class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
              <template x-for="(bank, code) in bankOptions" :key="code">
                <li class="flex items-center gap-3 rounded-md border border-[hsl(var(--border))] bg-[hsl(var(--background))] p-3">
                  <div class="flex h-10 w-10 items-center justify-center overflow-hidden rounded-full border border-[hsl(var(--border))] bg-white">
                    <img
                      class="h-8 w-8 object-contain"
                      :src="bank.logo"
                      :alt="lang === 'en' ? bank.name + ' logo' : 'ÿ¥ÿπÿßÿ± ' + bank.ar"
                      loading="lazy"
                    />
                  </div>
                  <div class="min-w-0">
                    <p class="text-sm font-medium leading-tight" x-text="lang === 'en' ? bank.name : bank.ar"></p>
                    <p class="text-xs text-[hsl(var(--muted-foreground))]" x-text="lang === 'en' ? 'Bank code: ' + code : 'ÿ±ŸÖÿ≤ ÿßŸÑÿ®ŸÜŸÉ: ' + code"></p>
                  </div>
                </li>
              </template>
            </ul>
          </div>
        </section>
      </div>

      <div x-show="activeTab==='card'" class="grid gap-6 lg:grid-cols-2" x-cloak>
        <section aria-labelledby="card-heading" class="flex min-h-[500px] flex-col rounded-lg border border-[hsl(var(--border))] bg-[hsl(var(--card))] text-[hsl(var(--card-foreground))] shadow-sm">
          <div class="flex flex-col space-y-1.5 p-6">
            <h2 id="card-heading" class="text-xl font-semibold" x-text="lang === 'en' ? 'Credit Card Generator' : 'ŸÖŸàŸÑÿØ ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑÿßÿ¶ÿ™ŸÖÿßŸÜ'"></h2>
            <p class="text-sm text-[hsl(var(--muted-foreground))]" x-text="lang === 'en' ? 'Generate random Saudi credit card data.' : 'ÿ™ŸàŸÑŸäÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿ≥ÿπŸàÿØŸäÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©.'"></p>
          </div>
          <div class="flex flex-1 flex-col space-y-5 px-6 pb-6">
            <div class="min-h-[160px] rounded-md border border-[hsl(var(--border))] bg-[hsl(var(--muted))] p-4 text-left">
              <div class="flex items-start justify-between gap-2">
                <p class="text-xs font-semibold text-[hsl(var(--muted-foreground))]" :class="lang === 'ar' ? 'text-right' : 'text-left'" x-text="lang === 'en' ? 'Generated Card' : 'ÿßŸÑÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑŸÖŸàŸÑÿØÿ©'"></p>
                <button
                  @click="copyCard()"
                  :disabled="!generatedCard"
                  type="button"
                  class="inline-flex h-8 w-8 items-center justify-center rounded-md text-[hsl(var(--muted-foreground))] transition hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))] disabled:pointer-events-none disabled:opacity-50"
                  :aria-label="lang === 'en' ? 'Copy Card' : 'ŸÜÿ≥ÿÆ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©'"
                  :title="lang === 'en' ? 'Copy Card' : 'ŸÜÿ≥ÿÆ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©'"
                >
                  <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                </button>
              </div>
              <p class="mt-2 font-mono text-base text-[hsl(var(--foreground))] md:text-lg force-ltr" x-text="animatedCardNumber.length ? formatCardNumber(animatedCardNumber.join('')) : '#### #### #### ####'"></p>
              <div class="mt-2 space-y-1 text-xs text-[hsl(var(--muted-foreground))]" :class="lang === 'ar' ? 'text-right' : 'text-left'">
                <p x-text="generatedCard ? generatedCard.name : (lang === 'en' ? 'FULL NAME' : 'ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ')"></p>
                <p x-text="generatedCard ? (lang === 'en' ? 'Expiry: ' + generatedCard.expiry : 'ÿßŸÜÿ™Ÿáÿßÿ°: ' + generatedCard.expiry) : (lang === 'en' ? 'Expiry: MM/YY' : 'ÿßŸÜÿ™Ÿáÿßÿ°: **/**')"></p>
                <p x-text="generatedCard ? (lang === 'en' ? 'CVV: ' + generatedCard.cvv : 'ÿ±ŸÖÿ≤: ' + generatedCard.cvv) : (lang === 'en' ? 'CVV: ***' : 'ÿ±ŸÖÿ≤: ***')"></p>
              </div>
            </div>

            <button
              @click="generateCard()"
              type="button"
              class="mt-auto inline-flex h-11 w-full items-center justify-center gap-2 rounded-md bg-[hsl(var(--primary))] px-4 text-sm font-medium text-[hsl(var(--primary-foreground))] shadow transition hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))] disabled:pointer-events-none disabled:opacity-70"
              :disabled="generating"
              :class="{ 'opacity-75 cursor-wait': generating }"
            >
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" :class="{ 'animate-spin-half': generating }"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
              <span x-text="generating ? (lang === 'en' ? 'Generating...' : 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ŸàŸÑŸäÿØ...') : (lang === 'en' ? 'Generate Card' : 'ÿ™ŸàŸÑŸäÿØ ÿ®ÿ∑ÿßŸÇÿ©')"></span>
            </button>
          </div>
        </section>

        <section aria-labelledby="card-history-heading" class="flex min-h-[500px] flex-col rounded-lg border border-[hsl(var(--border))] bg-[hsl(var(--card))] text-[hsl(var(--card-foreground))] shadow-sm">
          <div class="flex items-center justify-between p-6">
            <div class="space-y-1">
              <h2 id="card-history-heading" class="text-base font-semibold" x-text="lang === 'en' ? 'Recent Cards' : 'ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑÿ£ÿÆŸäÿ±ÿ©'"></h2>
              <p class="text-xs text-[hsl(var(--muted-foreground))]" x-text="lang === 'en' ? 'Last generated card details.' : 'ÿ¢ÿÆÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑŸÖŸèŸàŸÑÿØÿ©.'"></p>
            </div>
            <button
              @click="clearCardHistory()"
              type="button"
              class="inline-flex items-center gap-1 rounded-md border border-transparent px-2 py-1 text-xs font-medium transition hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))] disabled:opacity-50"
              :disabled="!cardHistory.length"
              :aria-label="lang === 'en' ? 'Clear History' : 'ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ'"
              :title="lang === 'en' ? 'Clear History' : 'ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ'"
            >
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6m5 0V4a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v2"/></svg>
              <span x-text="lang === 'en' ? 'Clear' : 'ŸÖÿ≥ÿ≠'"></span>
            </button>
          </div>
          <div class="flex flex-1 flex-col px-6 pb-6">
            <div class="min-h-[180px] flex-1">
              <template x-if="cardHistory.length">
                <ul class="space-y-2" aria-labelledby="card-history-heading">
                  <template x-for="(item, index) in cardHistory.slice(0, 4)" :key="item.number + index">
                    <li
                      class="history-list-item card-history-list-item rounded-md border border-[hsl(var(--border))] p-3 text-sm transition"
                      :class="{
                        'bg-[hsl(var(--background))] shadow-sm': index === 0,
                        'bg-[hsl(var(--muted))]': index > 0
                      }"
                      x-transition:enter="transition ease-out duration-300"
                      x-transition:enter-start="opacity-0 transform -translate-y-2"
                      x-transition:enter-end="opacity-100 transform translate-y-0"
                    >
                      <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                        <div class="min-w-0">
                          <span class="iban-text block truncate font-mono text-[hsl(var(--foreground))] force-ltr" x-text="formatCardNumber(item.number)" :title="item.number"></span>
                          <span class="block truncate text-xs text-[hsl(var(--muted-foreground))]" x-text="item.name" :title="item.name"></span>
                        </div>
                        <div class="flex items-center gap-2">
                          <button
                            @click="copyCardFromHistory(item.number)"
                            type="button"
                            class="inline-flex h-8 w-8 items-center justify-center rounded-md text-[hsl(var(--muted-foreground))] transition hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--background))]"
                            :aria-label="(lang === 'en' ? 'Copy card: ' : 'ŸÜÿ≥ÿÆ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©: ') + item.number"
                            :title="lang === 'en' ? 'Copy' : 'ŸÜÿ≥ÿÆ'"
                          >
                            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                          </button>
                          <div class="text-xs text-[hsl(var(--muted-foreground))]">
                            <span x-text="lang === 'en' ? 'Expiry: ' + item.expiry : 'ÿßŸÜÿ™Ÿáÿßÿ°: ' + item.expiry"></span>
                            <span class="ml-2" x-text="lang === 'en' ? 'CVV: ' + item.cvv : 'ÿ±ŸÖÿ≤: ' + item.cvv"></span>
                          </div>
                        </div>
                      </div>
                    </li>
                  </template>
                </ul>
              </template>
              <template x-if="!cardHistory.length">
                <p class="pt-10 text-center text-sm text-[hsl(var(--muted-foreground))]" x-text="lang === 'en' ? 'No recent cards.' : 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿ≠ÿØŸäÿ´ÿ©.'"></p>
              </template>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer class="mt-10 flex items-center justify-between text-xs text-[hsl(var(--muted-foreground))]">
      <a href="https://github.com/a-almazyad/saudi-iban-generator" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 rounded-md border border-[hsl(var(--border))] px-3 py-2 transition hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))]">
        GitHub Project
      </a>
      <div class="rounded-md border border-[hsl(var(--border))] px-3 py-2">
        Version: <span id="version-code">...</span>
      </div>
    </footer>
  </div>


  <script>
    function ibanApp() {
      return {
        lang: localStorage.getItem('lang') || 'en',
        darkMode: false,
        themePreference: 'auto',
        generating: false,
        activeTab: 'iban',
        generatedIban: null,
        generatedCard: null,
        selectedBankCode: '',
        ibanHistory: [],
        cardHistory: [],
        animatedIban: [],
        animatedBankName: '',
        animatedCardNumber: [],
        showToast: false,
        toastMessage: '',
        toastType: 'info',
        toastTimeout: null,

        HISTORY_LIMIT: 7,
        CARD_HISTORY_LIMIT: 7,
        ANIM_CHAR_INTERVAL: 30,
        ANIM_SLOT_INTERVAL: 40,
        ANIM_IBAN_CHAR_INTERVAL: 40,
        ANIM_IBAN_SLOT_INTERVAL: 50,
        ANIM_CARD_CHAR_INTERVAL: 40,
        ANIM_CARD_SLOT_INTERVAL: 50,

        firstNames: ['ABDULLAH', 'MOHAMMED', 'FAHAD', 'SULTAN', 'TURKI'],
        middleNames: ['AHMED', 'IBN', 'ABDUL', 'BIN', 'AL'],
        lastNames: ['ALSAUD', 'ALOTAIBI', 'ALHARBI', 'ALQAHTANI', 'ALFARHAN'],

        generateRandomName() {
          const f = this.firstNames[Math.floor(Math.random() * this.firstNames.length)];
          const m = this.middleNames[Math.floor(Math.random() * this.middleNames.length)];
          const l = this.lastNames[Math.floor(Math.random() * this.lastNames.length)];
          return `${f} ${m} ${l}`;
        },

        bankOptions: {
          '5':  { name: 'Alinma Bank', ar: 'ŸÖÿµÿ±ŸÅ ÿßŸÑÿ•ŸÜŸÖÿßÿ°', mark: 'IN', logo: 'logos/alinma.png' },
          '10': { name: 'SNB', ar: 'ÿßŸÑÿ®ŸÜŸÉ ÿßŸÑÿ£ŸáŸÑŸä ÿßŸÑÿ≥ÿπŸàÿØŸä', mark: 'SN', logo: 'logos/snb.png' },
          '15': { name: 'Bank Albilad', ar: 'ÿ®ŸÜŸÉ ÿßŸÑÿ®ŸÑÿßÿØ', mark: 'BB', logo: 'logos/bilad.png' },
          '20': { name: 'Riyad Bank', ar: 'ÿ®ŸÜŸÉ ÿßŸÑÿ±Ÿäÿßÿ∂', mark: 'RB', logo: 'logos/riyad.png' },
          '30': { name: 'Arab National Bank', ar: 'ÿßŸÑÿ®ŸÜŸÉ ÿßŸÑÿπÿ±ÿ®Ÿä ÿßŸÑŸàÿ∑ŸÜŸä', mark: 'AN', logo: 'logos/anb.png' },
          '36': { name: 'D360 Bank', ar: 'ÿ®ŸÜŸÉ ÿØŸäŸ£Ÿ¶Ÿ†', mark: 'D3', logo: 'logos/d360.png' },
          '45': { name: 'SABB', ar: 'ÿ≥ÿßÿ®', mark: 'SB', logo: 'logos/sabb.png' },
          '55': { name: 'BSF', ar: 'ÿßŸÑÿ®ŸÜŸÉ ÿßŸÑÿ≥ÿπŸàÿØŸä ÿßŸÑŸÅÿ±ŸÜÿ≥Ÿä', mark: 'BF', logo: 'logos/fransi.png' },
          '60': { name: 'Bank AlJazira', ar: 'ÿ®ŸÜŸÉ ÿßŸÑÿ¨ÿ≤Ÿäÿ±ÿ©', mark: 'BJ', logo: 'logos/jazira.png' },
          '65': { name: 'Investment Bank', ar: 'ÿßŸÑÿ®ŸÜŸÉ ÿßŸÑÿ≥ÿπŸàÿØŸä ŸÑŸÑÿßÿ≥ÿ™ÿ´ŸÖÿßÿ±', mark: 'SI', logo: 'logos/saib.png' },
          '78': { name: 'STC Bank', ar: 'ÿ®ŸÜŸÉ ÿ•ÿ≥ ÿ™Ÿä ÿ≥Ÿä', mark: 'ST', logo: 'logos/stc.png' },
          '80': { name: 'Al Rajhi Bank', ar: 'ŸÖÿµÿ±ŸÅ ÿßŸÑÿ±ÿßÿ¨ÿ≠Ÿä', mark: 'AR', logo: 'logos/rajhi.png' }
        },

        init() {
          const storedPreference = localStorage.getItem('themePreference');
          const legacyDarkMode = localStorage.getItem('darkMode');
          this.themePreference = storedPreference
            || (legacyDarkMode === 'true' ? 'dark' : legacyDarkMode === 'false' ? 'light' : 'auto');
          this.applyTheme(this.themePreference, false);
          this.lang = localStorage.getItem('lang') || 'en';
          this.loadHistory();
          this.fetchVersion();
          this.registerThemeListener();

          this.$watch('lang', (newLang) => {
            if (this.generatedIban && this.generatedIban.bankCode) {
                const bankInfo = this.bankOptions[this.generatedIban.bankCode];
                if(bankInfo) {
                    this.generatedIban.bank = newLang === 'en' ? bankInfo.name : bankInfo.ar;
                    this.animatedBankName = this.generatedIban.bank;
                }
            }
          });
        },

        applyTheme(preference, persist = true) {
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          const resolved = preference === 'dark'
            ? true
            : preference === 'light'
              ? false
              : prefersDark;
          this.darkMode = resolved;
          document.documentElement.classList.toggle('dark', resolved);
          if (persist) {
            localStorage.setItem('themePreference', preference);
            localStorage.removeItem('darkMode');
          }
        },

        setTheme(preference) {
          this.themePreference = preference;
        },

        registerThemeListener() {
          const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
          mediaQuery.addEventListener('change', () => {
            if (this.themePreference === 'auto') {
              this.applyTheme('auto', false);
            }
          });
        },

        computedBank() {
          return this.bankOptions[this.selectedBankCode] || null;
        },

        getBankInfoByName(englishName) {
            return Object.values(this.bankOptions).find(b => b.name === englishName) || null;
        },

        fetchVersion() {
          fetch('version.txt?t=' + Date.now())
            .then(res => {
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                return res.text();
            })
            .then(v => {
              const el = document.getElementById('version-code');
              if (el) el.textContent = v.trim() || 'N/A';
            })
            .catch(err => {
              console.warn('[Version Fetch Error]', err);
              const el = document.getElementById('version-code');
              if (el) el.textContent = 'N/A';
            });
        },

        loadHistory() {
          try {
            const storedHistory = JSON.parse(localStorage.getItem('ibanHistory') || '[]');
            if (Array.isArray(storedHistory) && storedHistory.every(item => typeof item === 'object' && item !== null && item.iban && item.bank)) {
              this.ibanHistory = storedHistory.slice(0, this.HISTORY_LIMIT);
            } else {
              this.ibanHistory = [];
              if (localStorage.getItem('ibanHistory')) {
                  localStorage.removeItem('ibanHistory');
              }
            }
          } catch (e) {
            console.error("Error loading history:", e);
            this.ibanHistory = [];
            localStorage.removeItem('ibanHistory');
          }

          try {
            const storedHistory = JSON.parse(localStorage.getItem('cardHistory') || '[]');
            if (Array.isArray(storedHistory) && storedHistory.every(item => typeof item === 'object' && item !== null && item.number && item.expiry && item.cvv && item.name)) {
              this.cardHistory = storedHistory.slice(0, this.CARD_HISTORY_LIMIT);
            } else {
              this.cardHistory = [];
              if (localStorage.getItem('cardHistory')) {
                  localStorage.removeItem('cardHistory');
              }
            }
          } catch (e) {
            console.error("Error loading card history:", e);
            this.cardHistory = [];
            localStorage.removeItem('cardHistory');
          }
        },

        generateIban() {
          if (this.generating) return;
          this.generating = true;

          setTimeout(() => {
            try {
              let actualBankCode = this.selectedBankCode;
              if (!actualBankCode) {
                const keys = Object.keys(this.bankOptions);
                actualBankCode = keys[Math.floor(Math.random() * keys.length)];
              }

              const bankInfo = this.bankOptions[actualBankCode];
              if (!bankInfo) throw new Error(`Invalid bank code: ${actualBankCode}`);

              const paddedBankCode = actualBankCode.toString().padStart(2, '0');
              let accountNumber = Array.from({length: 18}, () => Math.floor(Math.random() * 10)).join('');
              const bban = paddedBankCode + accountNumber;
              const checkDigits = this.calculateCheckDigits('SA', bban);

              if (checkDigits === 'XX') throw new Error('Check digit calculation failed.');

              const iban = 'SA' + checkDigits + bban;
              const displayBankName = this.lang === 'en' ? bankInfo.name : bankInfo.ar;
              const storedBankName = bankInfo.name;

              this.generatedIban = { iban, bank: displayBankName, bankCode: actualBankCode };

              this.$nextTick(() => {
                this.animateText('animatedBankName', displayBankName, this.ANIM_CHAR_INTERVAL, this.ANIM_SLOT_INTERVAL);
                this.animateIban('animatedIban', iban, this.ANIM_IBAN_CHAR_INTERVAL, this.ANIM_IBAN_SLOT_INTERVAL);
              });

              if (!this.ibanHistory.some(item => item.iban === iban)) {
                this.ibanHistory.unshift({ iban, bank: storedBankName });
                this.ibanHistory = this.ibanHistory.slice(0, this.HISTORY_LIMIT);
                localStorage.setItem('ibanHistory', JSON.stringify(this.ibanHistory));
              }
            } catch (error) {
                console.error("Error generating IBAN:", error);
                this.showToastMessage(this.lang === 'en' ? 'Error generating IBAN.' : 'ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸàŸÑŸäÿØ ÿßŸÑÿ¢Ÿäÿ®ÿßŸÜ.', 'error');
                this.generatedIban = null;
                this.animatedIban = [];
                this.animatedBankName = '';
            } finally {
                setTimeout(() => { this.generating = false; }, 400);
            }
          }, 50);
        },

        calculateCheckDigits(countryCode, bban) {
          const rearranged = bban + countryCode + '00';
          let converted = '';
          for (const ch of rearranged) {
            converted += isNaN(ch) ? (ch.toUpperCase().charCodeAt(0) - 55).toString() : ch;
          }
          try {
            const mod97 = BigInt(converted) % 97n;
            return String(98n - mod97).padStart(2, '0');
          } catch (e) {
            console.error("Check digit calculation failed:", e);
            return 'XX';
          }
        },


          generateCard() {
            if (this.generating) return;
            this.generating = true;
            setTimeout(() => {
              try {
                const number = window.CreditCard.generateVisaNumber();

              const now = new Date();
              const startMonth = now.getFullYear() * 12 + now.getMonth();
              const endMonth = startMonth + 60;
              const randMonth = Math.floor(Math.random() * (endMonth - startMonth + 1)) + startMonth;
              const year = Math.floor(randMonth / 12);
              const month = randMonth % 12;
              const expiry = String(month + 1).padStart(2, '0') + '/' + String(year % 100).padStart(2, '0');

              const cvv = Math.floor(100 + Math.random() * 900);
              const name = this.generateRandomName();

              this.generatedCard = { number, name, expiry, cvv };

              this.$nextTick(() => {
                this.animateCardNumber('animatedCardNumber', number, this.ANIM_CARD_CHAR_INTERVAL, this.ANIM_CARD_SLOT_INTERVAL);
              });

              if (!this.cardHistory.some(item => item.number === number)) {
                this.cardHistory.unshift({ number, name, expiry, cvv });
                this.cardHistory = this.cardHistory.slice(0, this.CARD_HISTORY_LIMIT);
                localStorage.setItem('cardHistory', JSON.stringify(this.cardHistory));
              }
            } finally {
              setTimeout(() => { this.generating = false; }, 400);
            }
          }, 50);
        },

        copyIban() {
          const ibanToCopy = this.generatedIban?.iban;
          if (!ibanToCopy) {
            this.showToastMessage(this.lang === 'en' ? 'Generate an IBAN first.' : 'ŸÇŸÖ ÿ®ÿ™ŸàŸÑŸäÿØ ÿ¢Ÿäÿ®ÿßŸÜ ÿ£ŸàŸÑÿßŸã.', 'info');
            return;
          }
          this.copyToClipboard(ibanToCopy, this.lang === 'en' ? 'IBAN copied!' : '!ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ¢Ÿäÿ®ÿßŸÜ');
        },

        copyIbanFromHistory(iban) {
            if (!iban) return;
            this.copyToClipboard(iban, this.lang === 'en' ? 'IBAN copied from history!' : '!ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ¢Ÿäÿ®ÿßŸÜ ŸÖŸÜ ÿßŸÑÿ≥ÿ¨ŸÑ');
        },

        copyCard() {
          const cardNum = this.generatedCard?.number;
          if (!cardNum) {
            this.showToastMessage(this.lang === 'en' ? 'Generate a card first.' : 'ŸÇŸÖ ÿ®ÿ™ŸàŸÑŸäÿØ ÿ®ÿ∑ÿßŸÇÿ© ÿ£ŸàŸÑÿßŸã.', 'info');
            return;
          }
          this.copyToClipboard(cardNum, this.lang === 'en' ? 'Card copied!' : '!ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©');
        },

        copyCardFromHistory(num) {
            if (!num) return;
            this.copyToClipboard(num, this.lang === 'en' ? 'Card copied from history!' : '!ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ© ŸÖŸÜ ÿßŸÑÿ≥ÿ¨ŸÑ');
        },

        copyToClipboard(text, successMessage) {
          if (!text) return;
          if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
              navigator.clipboard.writeText(text)
                .then(() => this.showToastMessage(successMessage, 'success'))
                .catch(err => {
                    console.warn('Clipboard API failed, falling back:', err);
                    this.fallbackCopy(text, successMessage);
                });
          } else {
              console.warn('Clipboard API not available, using fallback.');
              this.fallbackCopy(text, successMessage);
          }
        },

        fallbackCopy(text, successMessage) {
          const textarea = document.createElement('textarea');
          textarea.value = text;
          textarea.setAttribute('readonly', '');
          textarea.style.position = 'absolute';
          textarea.style.left = '-9999px';
          document.body.appendChild(textarea);
          let copied = false;
          try {
            textarea.select();
            copied = document.execCommand('copy');
          } catch (err) {
            console.error('Fallback copy execCommand failed:', err);
          }
          document.body.removeChild(textarea);

          if (copied) {
              this.showToastMessage(successMessage, 'success');
          } else {
              this.showToastMessage(this.lang === 'en' ? 'Failed to copy.' : '.ŸÅÿ¥ŸÑ ÿßŸÑŸÜÿ≥ÿÆ', 'error');
          }
        },

        clearHistory() {
          if (this.ibanHistory.length === 0) {
            this.showToastMessage(this.lang === 'en' ? 'History is already empty' : 'ÿßŸÑÿ≥ÿ¨ŸÑ ŸÅÿßÿ±ÿ∫ ÿ®ÿßŸÑŸÅÿπŸÑ', 'info');
            return;
          }

          const listItems = document.querySelectorAll('.iban-history-list-item');
          listItems.forEach((el, i) => {
            el.style.transition = `opacity 0.3s ease ${i * 0.03}s, transform 0.3s ease ${i * 0.03}s`;
            requestAnimationFrame(() => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(10px)';
            });
          });

          setTimeout(() => {
            this.ibanHistory = [];
            localStorage.removeItem('ibanHistory');
            this.$refs.generateButton?.focus();
          }, listItems.length * 30 + 350);
        },

        clearCardHistory() {
          if (this.cardHistory.length === 0) {
            this.showToastMessage(this.lang === 'en' ? 'History is already empty' : 'ÿßŸÑÿ≥ÿ¨ŸÑ ŸÅÿßÿ±ÿ∫ ÿ®ÿßŸÑŸÅÿπŸÑ', 'info');
            return;
          }

          const listItems = document.querySelectorAll('.card-history-list-item');
          listItems.forEach((el, i) => {
            el.style.transition = `opacity 0.3s ease ${i * 0.03}s, transform 0.3s ease ${i * 0.03}s`;
            requestAnimationFrame(() => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(10px)';
            });
          });

          setTimeout(() => {
            this.cardHistory = [];
            localStorage.removeItem('cardHistory');
          }, listItems.length * 30 + 350);
        },

        showToastMessage(msg, type = 'info') {
          if (this.toastTimeout) clearTimeout(this.toastTimeout);
          this.toastMessage = msg;
          this.toastType = type;
          this.showToast = true;
          this.toastTimeout = setTimeout(() => {
              this.showToast = false;
          }, 2500);
        },

        formatIban(iban) {
            if (!iban || typeof iban !== 'string' || iban.length !== 24) return iban;
            return iban.replace(/(SA\d{2})(\d{4})(\d{4})(\d{4})(\d{4})(\d{4})/, '$1 $2 $3 $4 $5 $6');
        },

        formatCardNumber(num) {
            if (!num || typeof num !== 'string' || num.length !== 16) return num;
            return num.replace(/(\d{4})(\d{4})(\d{4})(\d{4})/, '$1 $2 $3 $4');
        },

        animateText(propName, targetText, charIntervalSpeed, slotIntervalSpeed) {
            if (window[`${propName}Interval`]) clearInterval(window[`${propName}Interval`]);

            this[propName] = '';
            const targetChars = targetText.split('');
            let currentChars = Array(targetChars.length).fill(' ');
            let charIndex = 0;
            let intervalId;

            intervalId = setInterval(() => {
                if (charIndex >= targetChars.length) {
                    clearInterval(intervalId);
                    window[`${propName}Interval`] = null;
                    this[propName] = targetText;
                    return;
                }
                const currentSlot = charIndex;
                let cycleCount = 0;
                const maxCycles = 3;
                let charIntervalId = setInterval(() => {
                    if (cycleCount >= maxCycles) {
                        clearInterval(charIntervalId);
                        currentChars[currentSlot] = targetChars[currentSlot];
                        this[propName] = currentChars.join('');
                    } else {
                        currentChars[currentSlot] = String.fromCharCode(33 + Math.random() * 94);
                        this[propName] = currentChars.join('');
                        cycleCount++;
                    }
                }, charIntervalSpeed);
                charIndex++;
            }, slotIntervalSpeed);
            window[`${propName}Interval`] = intervalId;
        },

        animateIban(propName, targetIban, charIntervalSpeed, slotIntervalSpeed) {
            if (window[`${propName}Interval`]) clearInterval(window[`${propName}Interval`]);

            const targetChars = targetIban.split('');
            if (!Array.isArray(this[propName]) || this[propName].length !== targetChars.length) {
                 this[propName] = ['S', 'A', ...Array(targetChars.length - 2).fill('X')];
            }
            let currentChars = [...this[propName]];
            let charIndex = 2;
            let intervalId;

            intervalId = setInterval(() => {
                if (charIndex >= targetChars.length) {
                    clearInterval(intervalId);
                    window[`${propName}Interval`] = null;
                    this[propName] = [...targetChars];
                    return;
                }
                const currentSlot = charIndex;
                let cycleCount = 0;
                const maxCycles = 4;
                let charIntervalId = setInterval(() => {
                    if (cycleCount >= maxCycles) {
                        clearInterval(charIntervalId);
                        currentChars[currentSlot] = targetChars[currentSlot];
                        this[propName] = [...currentChars];
                    } else {
                        currentChars[currentSlot] = Math.floor(Math.random() * 10).toString();
                        this[propName] = [...currentChars];
                        cycleCount++;
                    }
                }, charIntervalSpeed);
                charIndex++;
            }, slotIntervalSpeed);
            window[`${propName}Interval`] = intervalId;
        },

        animateCardNumber(propName, targetNumber, charIntervalSpeed, slotIntervalSpeed) {
            if (window[`${propName}Interval`]) clearInterval(window[`${propName}Interval`]);
            const slotIntervalsKey = `${propName}SlotIntervals`;
            if (Array.isArray(window[slotIntervalsKey])) {
                window[slotIntervalsKey].forEach(clearInterval);
            }
            window[slotIntervalsKey] = [];

            const targetChars = targetNumber.split('');
            if (!Array.isArray(this[propName]) || this[propName].length !== targetChars.length) {
                 this[propName] = Array(targetChars.length).fill('#');
            }
            let currentChars = [...this[propName]];
            let charIndex = 0;
            let intervalId;

            intervalId = setInterval(() => {
                if (charIndex >= targetChars.length) {
                    clearInterval(intervalId);
                    window[`${propName}Interval`] = null;
                    this[propName] = [...targetChars];
                    return;
                }
                const currentSlot = charIndex;
                let cycleCount = 0;
                const maxCycles = 4;
                let charIntervalId = setInterval(() => {
                    if (cycleCount >= maxCycles) {
                        clearInterval(charIntervalId);
                        currentChars[currentSlot] = targetChars[currentSlot];
                        this[propName] = [...currentChars];
                    } else {
                        currentChars[currentSlot] = Math.floor(Math.random() * 10).toString();
                        this[propName] = [...currentChars];
                        cycleCount++;
                    }
                }, charIntervalSpeed);
                window[slotIntervalsKey].push(charIntervalId);
                charIndex++;
            }, slotIntervalSpeed);
            window[`${propName}Interval`] = intervalId;
        },
      }
    }
  </script>

</body>
</html>
